<!DOCTYPE html>
<html lang="en">
<head>
<title>OpenCPU Markdown App</title>
    
<script src="underscore-min.js"></script>    
<script src="jquery-1.10.2.min.js"></script>
<script src="opencpu-0.5.js"></script>
<script src="src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>

<script>
$(function(){

  //This app requires OpenCPU 1.0.1 or higher!
   //ocpu.seturl("http://localhost:5656/ocpu/library/markdownapp/R");
   //ocpu.seturl("http://206.12.91.148/ocpu/library/markdownapp/R");
   ocpu.seturl("http://206.12.91.148/ocpu/library/rmdocpu/R");
   
  function domarkdown(e){
    var req = ocpu.call(
      //"rmdtext", {text : editor.getSession().getValue()}, 
      "render_rmd_url",{rmd_url : 'https://raw.githubusercontent.com/ningzhibin/metalab/master/inst/rmd/input.Rmd'},
      //"render_rmd_server",{rmd_file: 'input.Rmd'},
    function(session){
      
    console.log(session);
		
		 	session.getConsole(function(outtxt){
				console.log(outtxt);
  			});
		
		
      $("iframe").attr('src', session.getFileURL("output.html"));     
    }).fail(function(text){
      alert("Error: " + req.responseText);
    });
  }

  //auto run after 2 seconds of no activity
  //var update = _.debounce(domarkdown, 2000);
  domarkdown();  
});
</script>

<style type="text/css" media="screen">
iframe { 
  position: absolute;
  top: 0px;
  right: 0px;
  width: 50%;
  height: 100%;
  border: 0;
  margin: 0;
  z-index: 999999;
}

</style>
</head>
<body>
  
  <div>
    
      <h1>Uploading a CSV File</h1>
      
      <b>Upload File:</b> 
      
      <input type="file" id="csvfile"> 
      
      <br/>
      <b>First line as header?</b> 
        
        <input type="radio" name = "header" value="true" checked="checked">yes
        <input type="radio" name = "header" value="false">no
        
        <br>
        
      <b>Separator:</b> 
        <input type="radio" name = "separator" value= "&#09;" checked="checked" >tab( .tsv)
        <input type="radio" name = "separator" value= "," >comma( .csv)
        
      
      <br />
      <button id="submitbutton_upload" type="button">read.csv</button>
      <pre><code id="output"></code></pre>
    
    
  </div>  
  
  

<div>
  <iframe src="about:blank"></iframe>
</div>
</body>
</html>
