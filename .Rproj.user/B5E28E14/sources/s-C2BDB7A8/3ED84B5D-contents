---
title: "Maxquant Summary.txt Summary"
author: "ningzhibinn@gmail.com"
date: "`r Sys.time()`"
output:
  html_document:
    fig_width: 10
    fig_caption: TRUE
    toc: true
    toc_depth: 4
    toc_float:
      collapsed: TRUE
      smooth_scroll: TRUE
    number_sections: true
params:  
  summary_file_tbl: !r mtcars ### note that the value is the real value, here supposed to be a read in data.table for one click function.  
---

<style type="text/css">
.main-container {
  max-width: 1800px;
  margin-left: auto;
  margin-right: auto;
}
</style>


```{r setup, include=FALSE}
# enviroment setup
knitr::opts_chunk$set(echo = FALSE,warning = FALSE, message = FALSE, cache = TRUE)
# if you have a large file (large dataset to process) to knit, set cache = TRUE to speed up the test process

source("https://raw.githubusercontent.com/ningzhibin/rmdocpu/master/inst/subfunctions_general.r")
source("https://raw.githubusercontent.com/ningzhibin/rmdocpu/master/inst/subfunctions_general_update.r")

#library(DT) # for interactive data table display 
library(tidyverse)
library(ggplot2)
#library(plotly)
#library(jsonlite)



# rmarkdown::render("MQ_report_summary_ocpu.Rmd", params = list(summary_file_tbl =  your_readin_tbl))


```





```{r recho=FALSE}

tidy_MQ_summary <- function(df_summary.txt){
  
  # df_summary.txt has to be a tidyverse tbl format, from read_tsv
  # take out the last line to organize into a data.frame
  
  last_line <- t(df_summary.txt[nrow(df_summary.txt),])
  last_line[last_line[,1] == ""] <- NA
  last_line[last_line[,1] == "0"] <- NA
  last_line <- last_line[-1,, drop = FALSE]
  last_line <- last_line[which(!is.na(last_line[,1])),, drop =  FALSE]
  colnames(last_line) <- ("values")
  
  # take out rows about raw files summary
  summary <- df_summary.txt[-nrow(df_summary.txt),] # remove the last line
   
  df_rawfiles <-summary[!is.na(summary$Experiment),]
  
  # take out rows about experiment summary
  df_experiment <- summary[is.na(summary$Experiment),]

  
  return(list("summary_all" = last_line,
              "summary_rawfiles" = df_rawfiles,
              "summary_experiment" = df_experiment
              
  ))
  
}


```



```{r title, echo=FALSE,fig.width= 15,fig.height=10}
# only for debugging
# summary_file  <- read_tsv("www/22122017_Colon_Aging_summary.txt", col_names = TRUE)

# start from the data table for parametrized version
summary_file_summary <- tidy_MQ_summary(params$summary_file_tbl)


#t <- toJSON(summary_file)

#tt <- paste0("data = ", t)


```


# Identification by Experiment

```{r id_by_experiment, echo=FALSE,fig.width= 10,fig.height=8}

exp <- summary_file_summary$summary_experiment
p <-ggplot(data=exp, aes(x=`Raw file`, y=`Peptide Sequences Identified`)) +
  geom_bar(stat="identity") + coord_flip()

ggplotly(p)

```




# Overal performance

check the averaged performance from all raw files:

```{r echo=FALSE}
nrows <- nrow(summary_file_summary$summary_all)
datatable(summary_file_summary$summary_all,options = list(pageLength = nrows))

```

























